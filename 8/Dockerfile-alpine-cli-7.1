FROM digitalpulp/cli:codeship
LABEL maintainer="digitalpulp"

RUN mkdir /var/www && chown -R www-data:www-data /var/www

USER www-data
RUN composer global require drush/drush:8.1.15 \
   && composer global config minimum-stability dev \
   && composer global config prefer-stable true \
   && composer global require drupal/console-launcher:1.0.2 \
   && ln -s /home/www-data/.composer/vendor/drush/drush/drush /usr/local/bin/drush \
   && ln -s /home/www-data/.composer/vendor/drupal/console-launcher/bin /usr/local/bin/drupal \
   && chmod ugo=rx /home/www-data/.composer/vendor/drush/drush/drush \
   && chmod ugo=rx /home/www-data/.composer/vendor/drupal/console-launcher/bin \
   && chmod ugo=rx /usr/local/bin/drush \
   && chmod ugo=rx /usr/local/bin/drupal \
   && drush core-status -y

VOLUME /var/www

CMD ["tail", "-f", "/dev/null"]
